rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Sector: Neural_Records
    // Protocol: AGENT_ISOLATION_PROTOCOL_V3
    match /users/{userId} {
      // Access granted only to the authenticated identity matching the sector ID
      allow read: if request.auth != null && request.auth.uid == userId;
      
      // Validation protocols for data integrity & Industrial Limits
      allow write: if request.auth != null && request.auth.uid == userId
                   && (request.resource.data.currency == null || (request.resource.data.currency is number && request.resource.data.currency >= 0))
                   && (request.resource.data.inventory == null || (request.resource.data.inventory is list && request.resource.data.inventory.size() <= 25))
                   && (request.resource.data.displayName == null || request.resource.data.displayName is string)
                   && (request.resource.data.photoURL == null || request.resource.data.photoURL is string);
    }
    
    // Default Protocol: TOTAL_DENIAL
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
